<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è³£å±‹è­°åƒ¹è©¦ç®—</title>
  <style>
    :root{
      /* ä½ æŒ‡å®šçš„ä¸»è‰² */
      --brand:#215440;

      /* æ­é…å¥¶æ²¹è‰²ï¼ˆåæš–ã€è€çœ‹ï¼‰ */
      --cream:#F6EAD5;
      --cream2:#F2DFC2;

      /* æ·±è‰²èƒŒæ™¯ç³»ï¼ˆè®“å¥¶æ²¹è‰²æ›´è·³ï¼‰ */
      --bg:#0B1510;
      --card:#0F221A;
      --card2:#0C1C15;

      --text:#F7F2E8;
      --muted:rgba(246,234,213,.72);

      --border:rgba(246,234,213,.18);
      --shadow: 0 14px 35px rgba(0,0,0,.40);
      --radius:18px;

      /* ç‹€æ…‹è‰² */
      --danger:#ff6b6b;
      --ok:#2ee59d;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(33,84,64,.35), transparent 60%),
        radial-gradient(1000px 700px at 90% 10%, rgba(246,234,213,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px 40px}
    .card{
      background: linear-gradient(180deg, rgba(246,234,213,.06), rgba(246,234,213,.03));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header.card{padding:18px}
    h1{margin:0;font-size:28px;letter-spacing:.5px}
    .sub{margin:8px 0 0;color:var(--muted);line-height:1.55}

    .grid{display:grid;grid-template-columns: 1.15fr .85fr; gap:16px; margin-top:16px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}}

    .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background: rgba(246,234,213,.03);
    }
    .bd{padding:16px}

    .tag{
      font-size:12px;color:var(--muted);
      border:1px solid var(--border);
      padding:6px 10px;border-radius:999px;
      white-space:nowrap;
    }

    .mode{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border);
      background: rgba(246,234,213,.04);
      color:var(--text);
      padding:10px 12px;border-radius:999px;
      cursor:pointer;font-weight:750;
      transition:.15s transform,.15s background,.15s border-color;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(246,234,213,.35)}
    .btn.active{
      background: rgba(33,84,64,.55);
      border-color: rgba(246,234,213,.40);
      box-shadow: 0 10px 22px rgba(33,84,64,.22);
    }

    .secTitle{font-size:14px;color:var(--muted);margin:0 0 10px}
    .form{display:grid;grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width: 560px){.form{grid-template-columns:1fr}}

    label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px}
    .field{
      border:1px solid var(--border);border-radius:14px;
      padding:10px 12px;background: rgba(0,0,0,.14);
    }
    input, select{
      width:100%;
      border:0; outline:0;
      background: transparent;
      color: var(--text);
      font-size:16px;
    }
    .hint{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.55}

    .warn{
      margin-top:10px;
      border:1px solid rgba(255,107,107,.35);
      background: rgba(255,107,107,.10);
      color: #ffd1d1;
      padding:10px 12px;border-radius:14px;
      display:none;
    }

    /* ====== çµæœå€ï¼šæ›´é¡¯çœ¼ã€æ›´æœ‰å€éš”ï¼ˆä½ è¦æ±‚çš„ï¼‰ ====== */
    .resultWrap{
      background:
        radial-gradient(700px 260px at 10% 0%, rgba(33,84,64,.35), transparent 60%),
        linear-gradient(180deg, rgba(246,234,213,.06), rgba(246,234,213,.02));
      border:1px solid rgba(246,234,213,.22);
      border-radius: 20px;
      padding: 14px;
    }
    .resultGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .resultMain{
      border-radius:18px;
      border:1px solid rgba(246,234,213,.26);
      background: linear-gradient(135deg, rgba(33,84,64,.70), rgba(33,84,64,.35));
      padding:16px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    .resultMain .k{font-size:12px;color:rgba(246,234,213,.85)}
    .resultMain .v{
      margin-top:6px;
      font-size:40px;
      font-weight:900;
      letter-spacing:.3px;
      color: var(--cream);
      text-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .resultMain .v small{font-size:16px;font-weight:800;color:rgba(246,234,213,.85)}

    .kpis{display:grid;gap:10px}
    .kpi{
      border:1px solid rgba(246,234,213,.20);
      border-radius:16px;
      padding:14px 14px;
      background: rgba(0,0,0,.14);
    }
    .kpi .k{font-size:12px;color:var(--muted)}
    .kpi .v{font-size:22px;font-weight:850;margin-top:6px;color:var(--cream)}
    .kpi .v small{font-size:14px;color:rgba(246,234,213,.75);font-weight:800}

    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn2{
      appearance:none;border:1px solid rgba(246,234,213,.30);
      background: rgba(33,84,64,.45);
      color: var(--text);
      padding:11px 12px;border-radius:14px;
      cursor:pointer;font-weight:850;
      flex:1;
      min-width: 180px;
      transition:.15s transform,.15s background,.15s border-color;
    }
    .btn2:hover{transform: translateY(-1px); background: rgba(33,84,64,.62); border-color: rgba(246,234,213,.42)}
    .btn2.ghost{
      border-color: rgba(246,234,213,.18);
      background: rgba(246,234,213,.04);
      font-weight:750;
    }
    .btn2:active{transform: translateY(1px)}

    .pillRow{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .pill{
      border:1px solid var(--border);
      background: rgba(246,234,213,.04);
      padding:8px 10px; border-radius:999px;
      font-size:12px; color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .pill.active{
      border-color: rgba(246,234,213,.38);
      background: rgba(33,84,64,.55);
      color: var(--cream);
    }

    #feeFeedback{margin-top:8px;font-size:12px;color:var(--muted);line-height:1.45}

    /* =========================
       å³å´å›ºå®š Floating Action Buttons + æµ®æ¨™
       ========================= */
    .fabStack{
      position: fixed;
      right: 18px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 9999;
    }
    .fab{
      position: relative;
      width: 54px;
      height: 54px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      text-decoration: none;
      border: 1px solid rgba(246,234,213,.30);
      background: rgba(33,84,64,.55);
      box-shadow: 0 12px 26px rgba(0,0,0,.40);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .fab:hover{
      transform: translateY(-1px);
      background: rgba(33,84,64,.75);
      border-color: rgba(246,234,213,.45);
    }
    .fab:active{transform: translateY(1px)}
    .fabIcon{
      width: 26px;
      height: 26px;
      display: grid;
      place-items: center;
      color: var(--cream);
    }

    /* æµ®æ¨™ï¼ˆtooltipï¼‰â€” åŒé…è‰² */
    .fabTip{
      position: absolute;
      right: calc(100% + 10px);
      top: 50%;
      transform: translateY(-50%);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--cream);
      white-space: nowrap;
      border: 1px solid rgba(246,234,213,.26);
      background: rgba(15,34,26,.95);
      box-shadow: 0 14px 35px rgba(0,0,0,.40);
      opacity: 0;
      pointer-events: none;
      transition: opacity .12s ease, transform .12s ease;
    }
    .fab:hover .fabTip{
      opacity: 1;
      transform: translateY(-50%) translateX(-2px);
    }
    .fabTip::after{
      content:"";
      position:absolute;
      right:-6px;
      top:50%;
      width: 10px;
      height: 10px;
      background: rgba(15,34,26,.95);
      border-right: 1px solid rgba(246,234,213,.26);
      border-top: 1px solid rgba(246,234,213,.26);
      transform: translateY(-50%) rotate(45deg);
    }

    @media (max-width: 640px){
      .fabTip{display:none;}
      .fabStack{right: 12px;}
      .fab{width:50px;height:50px;}
    }
  </style>
</head>
<body>

  <!-- å³å´å›ºå®šåœ“å½¢æµ®å‹•æŒ‰éˆ• -->
  <div class="fabStack" aria-label="å¿«æ·é€£çµ">
    <!-- å®˜ç¶² -->
    <a class="fab" href="https://www.lin1356.com.tw/tw" target="_blank" rel="noopener noreferrer" aria-label="å®˜æ–¹ç¶²ç«™">
      <span class="fabTip">å®˜æ–¹ç¶²ç«™</span>
      <span class="fabIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none">
          <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" stroke="currentColor" stroke-width="1.8"/>
          <path d="M3.6 9h16.8M3.6 15h16.8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M12 3c2.6 2.6 4 5.7 4 9s-1.4 6.4-4 9c-2.6-2.6-4-5.7-4-9s1.4-6.4 4-9Z" stroke="currentColor" stroke-width="1.8"/>
        </svg>
      </span>
    </a>

    <!-- LINE -->
    <a class="fab" href="https://lin.ee/vkmjsW8" target="_blank" rel="noopener noreferrer" aria-label="LINE è«®è©¢">
      <span class="fabTip">LINE è«®è©¢</span>
      <span class="fabIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none">
          <path d="M12 4c5 0 9 3.2 9 7.1 0 3.9-4 7.1-9 7.1-1 0-1.9-.1-2.8-.3L6 20l.8-3.2C5 15.6 3 13.5 3 11.1 3 7.2 7 4 12 4Z"
                stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
          <path d="M8 11h.01M12 11h.01M16 11h.01" stroke="currentColor" stroke-width="2.6" stroke-linecap="round"/>
        </svg>
      </span>
    </a>

    <!-- Facebookï¼ˆf å­—æ¨£ï¼‰ -->
    <a class="fab" href="https://www.facebook.com/LL2951356/" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
      <span class="fabTip">Facebook</span>
      <span class="fabIcon" aria-hidden="true" style="font-weight:950;font-size:22px;line-height:1;">
        f
      </span>
    </a>
  </div>

  <div class="wrap">
    <header class="card">
      <h1>è³£å±‹è­°åƒ¹è©¦ç®—</h1>
      <div class="sub">è¼¸å…¥ç›®æ¨™å›æ”¶/ç²åˆ©ï¼Œä¾å…¬å¼å›æ¨ã€Œå»ºè­°æˆäº¤åƒ¹ã€ã€‚å–®ä½ï¼šè¬</div>
    </header>

    <div class="grid">
      <!-- å·¦ï¼šè¼¸å…¥ -->
      <section class="card">
        <div class="hd">
          <div class="mode">
            <button id="modeTotal" class="btn" type="button" onclick="setMode('total')">æˆ‘ç®—ç¸½å›æ”¶ï¼ˆå«æœ¬é‡‘ï¼‰</button>
            <button id="modeProfit" class="btn" type="button" onclick="setMode('profit')">æˆ‘ç®—ç´”ç²åˆ©ï¼ˆä¸å«æœ¬é‡‘ï¼‰</button>
          </div>
          <div class="tag">å–®ä½ï¼šè¬</div>
        </div>

        <div class="bd">
          <p class="secTitle">1) ç›®æ¨™</p>
          <div class="form">
            <div class="field">
              <label id="targetLabel">ğŸ’ è³£æ–¹æ¬²å¯¦æ‹¿ç¸½é¡ (å«æœ¬é‡‘)</label>
              <input id="netTarget" type="number" min="0" step="0.1" placeholder="ä¾‹å¦‚ï¼š1200 (åŒ…å«æˆæœ¬)" oninput="solve()" />
              <div class="hint">è¼¸å…¥ 0 æœƒæ¸…ç©ºçµæœ</div>
            </div>
          </div>

          <div id="lossWarning" class="warn">âš ï¸ ç›®æ¨™ä½æ–¼æˆæœ¬ï¼Œå¯èƒ½æ˜¯è³ å”®ï¼ˆæœ¬å…¬å¼æœƒé€²å…¥ç¨…é‡‘=0 åˆ†æ”¯ï¼‰ã€‚</div>

          <div style="height:14px"></div>

          <p class="secTitle">2) æˆæœ¬èˆ‡ç¨…å‹™åƒæ•¸</p>
          <div class="form">
            <div class="field">
              <label>åŸå§‹å–å¾—æˆæœ¬ Cost</label>
              <input id="cost" type="number" min="0" step="0.1" value="0" oninput="solve()" />
            </div>
            <div class="field">
              <label>é›œæ”¯/ä»£æ›¸è²» Exp</label>
              <input id="miscExp" type="number" min="0" step="0.1" value="0" oninput="solve()" />
            </div>
            <div class="field">
              <label>åœŸåœ°å¢å€¼æ‰£é™¤ LandInc</label>
              <input id="landIncDed" type="number" min="0" step="0.1" value="0" oninput="solve()" />
            </div>
            <div class="field">
              <label>å·²ç¹³åœŸå¢ç¨… LandPaid</label>
              <input id="landTaxPaid" type="number" min="0" step="0.1" value="0" oninput="solve()" />
            </div>
            <div class="field">
              <label>æˆ¿åœ°åˆä¸€ç¨…ç‡ Rate</label>
              <select id="taxRate" onchange="solve()">
                <option value="0.45">45%ï¼ˆ2å¹´å…§ï¼‰</option>
                <option value="0.35">35%ï¼ˆ2ï½5å¹´ï¼‰</option>
                <option value="0.20" selected>20%ï¼ˆ5ï½10å¹´ï¼‰</option>
                <option value="0.15">15%ï¼ˆ10å¹´ä»¥ä¸Šï¼‰</option>
                <option value="0">0%ï¼ˆå…ç¨…ï¼‰</option>
              </select>
            </div>
          </div>

          <div style="height:14px"></div>

          <p class="secTitle">3) ä»²ä»‹è²»æ¨¡å¼</p>

          <div class="pillRow">
            <div id="feeModePercent" class="pill active" onclick="updateFeeMode('percent'); toggleFeeUI();">ä¾æˆäº¤åƒ¹ %</div>
            <div id="feeModeFixed" class="pill" onclick="updateFeeMode('fixed'); toggleFeeUI();">å›ºå®šé‡‘é¡</div>
          </div>

          <div class="form" style="margin-top:10px">
            <div class="field" id="feePercentWrap">
              <label>ä»²ä»‹è²»æ¯”ä¾‹ feePercentï¼ˆ%ï¼‰</label>
              <input id="feePercent" type="number" min="0" step="0.01" value="4" oninput="solve()" />
              <div class="hint">ä¾‹å¦‚ï¼š4 ä»£è¡¨ 4%</div>
            </div>
            <div class="field" id="feeAmountWrap" style="display:none">
              <label>ä»²ä»‹è²»å›ºå®šé‡‘é¡ feeAmountï¼ˆè¬ï¼‰</label>
              <input id="feeAmount" type="number" min="0" step="0.1" value="" oninput="solve()" />
              <div class="hint">å›ºå®šè²»ç”¨ï¼ˆè¬ï¼‰</div>
            </div>
          </div>

          <div id="feeFeedback"></div>
        </div>
      </section>

      <!-- å³ï¼šçµæœï¼ˆæ›´é¡¯çœ¼ã€æ›´æœ‰å€éš”ï¼‰ -->
      <aside class="card">
        <div class="hd">
          <div style="font-weight:900;color:var(--cream)">çµæœ</div>
          <div class="tag">å³æ™‚è¨ˆç®—</div>
        </div>
        <div class="bd">
          <div class="resultWrap">
            <div class="resultGrid">
              <!-- ä¸»çµæœï¼šå»ºè­°æˆäº¤åƒ¹ï¼ˆæœ€é¡¯çœ¼ï¼‰ -->
              <div class="resultMain">
                <div class="k">å»ºè­°æˆäº¤åƒ¹</div>
                <div class="v"><span id="finalPrice">0</span> <small>è¬</small></div>
              </div>

              <!-- æ¬¡çµæœ -->
              <div class="kpis">
                <div class="kpi">
                  <div class="k">é ä¼°ç¨…é‡‘</div>
                  <div class="v"><span id="taxResult">0</span> <small>è¬</small></div>
                </div>
                <div class="kpi">
                  <div class="k">ä»²ä»‹è²»</div>
                  <div class="v"><span id="feeResult">0</span> <small>è¬</small></div>
                </div>
                <div class="kpi">
                  <div class="k" id="verifyLabel">å¯¦éš›å›æ”¶ (é©—ç®—)</div>
                  <div class="v"><span id="verifyNet">0</span> <small>è¬</small></div>
                </div>
              </div>

              <div class="row">
                <button class="btn2" type="button" onclick="copyText()">è¤‡è£½çµæœ</button>
                <button class="btn2 ghost" type="button" onclick="resetAll()">é‡è¨­</button>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // ç‹€æ…‹ç®¡ç†ï¼ˆå…¬å¼ç¶­æŒä¸è®Šï¼‰
    let calculationMode = 'total';
    let feeInputMode = 'percent';

    function setMode(mode) {
      calculationMode = mode;
      document.getElementById('modeTotal').classList.remove('active');
      document.getElementById('modeProfit').classList.remove('active');
      if (mode === 'total') {
        document.getElementById('modeTotal').classList.add('active');
        document.getElementById('targetLabel').innerText = "ğŸ’ è³£æ–¹æ¬²å¯¦æ‹¿ç¸½é¡ (å«æœ¬é‡‘)";
        document.getElementById('netTarget').placeholder = "ä¾‹å¦‚ï¼š1200 (åŒ…å«æˆæœ¬)";
        document.getElementById('verifyLabel').innerText = "å¯¦éš›å›æ”¶ (é©—ç®—)";
      } else {
        document.getElementById('modeProfit').classList.add('active');
        document.getElementById('targetLabel').innerText = "ğŸ’ è³£æ–¹ç›®æ¨™ç²åˆ© (ä¸å«æœ¬é‡‘)";
        document.getElementById('netTarget').placeholder = "ä¾‹å¦‚ï¼š200 (æˆæœ¬ä¹‹å¤–å¤šè³ºçš„)";
        document.getElementById('verifyLabel').innerText = "å¯¦éš›ç²åˆ© (é©—ç®—)";
      }
      solve();
    }

    function updateFeeMode(mode) {
      feeInputMode = mode;
      if(mode === 'percent') document.getElementById('feeAmount').value = '';
      solve();
    }

    function toggleFeeUI(){
      const isPercent = feeInputMode === 'percent';
      document.getElementById('feeModePercent').classList.toggle('active', isPercent);
      document.getElementById('feeModeFixed').classList.toggle('active', !isPercent);
      document.getElementById('feePercentWrap').style.display = isPercent ? 'block' : 'none';
      document.getElementById('feeAmountWrap').style.display = isPercent ? 'none' : 'block';
    }

    function solve() {
      let userInputTarget = parseFloat(document.getElementById('netTarget').value) || 0;
      const Cost = parseFloat(document.getElementById('cost').value) || 0;
      const Exp = parseFloat(document.getElementById('miscExp').value) || 0;
      const LandInc = parseFloat(document.getElementById('landIncDed').value) || 0;
      const LandPaid = parseFloat(document.getElementById('landTaxPaid').value) || 0;
      const Rate = parseFloat(document.getElementById('taxRate').value) || 0.2;

      let TargetNet = 0;
      if (calculationMode === 'profit') {
        TargetNet = Cost + userInputTarget;
        document.getElementById('lossWarning').style.display = 'none';
      } else {
        TargetNet = userInputTarget;
        if (userInputTarget > 0 && Cost > 0 && userInputTarget < Cost) {
          document.getElementById('lossWarning').style.display = 'block';
        } else {
          document.getElementById('lossWarning').style.display = 'none';
        }
      }

      if (TargetNet === 0) {
        updateDisplay(0,0,0,0);
        document.getElementById('feeFeedback').innerText = "";
        return;
      }

      let f_rate = 0;
      let f_fixed = 0;
      if (feeInputMode === 'percent') {
        f_rate = (parseFloat(document.getElementById('feePercent').value) || 4) / 100;
      } else {
        f_fixed = parseFloat(document.getElementById('feeAmount').value) || 0;
      }

      let X = 0;
      let Tax = 0;
      let Fee = 0;
      let X_taxable = 0;

      if (feeInputMode === 'percent') {
        let numerator = TargetNet + Exp + LandPaid - (Rate * (Cost + Exp + LandInc));
        let denominator = (1 - f_rate) * (1 - Rate);
        if (denominator !== 0) X_taxable = numerator / denominator;
      } else {
        let numerator = TargetNet + f_fixed + Exp + LandPaid - (Rate * (Cost + Exp + f_fixed + LandInc));
        let denominator = 1 - Rate;
        if (denominator !== 0) X_taxable = numerator / denominator;
      }

      let Fee_taxable = (feeInputMode === 'percent') ? X_taxable * f_rate : f_fixed;
      let TaxBase = X_taxable - Cost - Exp - Fee_taxable - LandInc;

      if (TaxBase > 0) {
        X = X_taxable;
        Fee = Fee_taxable;
        Tax = TaxBase * Rate;
      } else {
        Tax = 0;
        if (feeInputMode === 'percent') {
          X = (TargetNet + Exp + LandPaid) / (1 - f_rate);
          Fee = X * f_rate;
        } else {
          X = TargetNet + Exp + LandPaid + f_fixed;
          Fee = f_fixed;
        }
      }

      if (X > 0 && isFinite(X)) {
        if (feeInputMode === 'percent') {
          document.getElementById('feeAmount').value = Fee.toFixed(1);
          document.getElementById('feeFeedback').innerText = `ä¾æˆäº¤åƒ¹ ${document.getElementById('feePercent').value}% è¨ˆç®—`;
        } else {
          let currentRate = (Fee / X) * 100;
          document.getElementById('feePercent').value = currentRate.toFixed(2);
          document.getElementById('feeFeedback').innerHTML = (currentRate > 6) ?
            `<span style="color:var(--danger)">âš ï¸ ç›®å‰ç´„ ${currentRate.toFixed(2)}% (è¶…æ¨™)</span>` :
            `æ›ç®—ç´„æˆäº¤åƒ¹ ${currentRate.toFixed(2)}%`;
        }

        let realNetPocket = X - Fee - Exp - LandPaid - Tax;
        let verifyValue = (calculationMode === 'profit') ? (realNetPocket - Cost) : realNetPocket;

        updateDisplay(X, Tax, Fee, verifyValue);
      }
    }

    function updateDisplay(price, tax, fee, verify) {
      document.getElementById('finalPrice').textContent = Math.round(price).toLocaleString();
      document.getElementById('taxResult').textContent = Math.round(tax).toLocaleString();
      document.getElementById('feeResult').textContent = Math.round(fee).toLocaleString();
      document.getElementById('verifyNet').textContent = Math.round(verify).toLocaleString();
    }

    function copyText() {
      let targetText = document.getElementById('netTarget').value || "0";
      let modeText = (calculationMode === 'total') ? "ç¸½å›æ”¶(å«æœ¬é‡‘)" : "ç´”ç²åˆ©(ä¸å«æœ¬é‡‘)";
      let text = `ã€è³£å±‹è­°åƒ¹è©¦ç®—ã€‘\nç›®æ¨™ï¼š${modeText} ${targetText} è¬\n----------------\nå»ºè­°æˆäº¤åƒ¹ï¼š${document.getElementById('finalPrice').innerText} è¬\né ä¼°ç¨…é‡‘ï¼š${document.getElementById('taxResult').innerText} è¬\nä»²ä»‹è²»ï¼š${document.getElementById('feeResult').innerText} è¬`;
      navigator.clipboard.writeText(text).then(() => alert("å·²è¤‡è£½ï¼"));
    }

    function resetAll(){
      document.getElementById('netTarget').value = "";
      document.getElementById('cost').value = 0;
      document.getElementById('miscExp').value = 0;
      document.getElementById('landIncDed').value = 0;
      document.getElementById('landTaxPaid').value = 0;
      document.getElementById('taxRate').value = 0.2;
      document.getElementById('feePercent').value = 4;
      document.getElementById('feeAmount').value = "";
      updateFeeMode('percent');
      toggleFeeUI();
      setMode('total');
      updateDisplay(0,0,0,0);
      document.getElementById('feeFeedback').innerText = "";
      document.getElementById('lossWarning').style.display = 'none';
    }

    // init
    setMode('total');
    toggleFeeUI();
  </script>
</body>
</html>
